# ArduinoCar
Скетчи и инструкция для робота-машинки на базе Arduino.

### 1. Сборка машинки
На занятиях мы с вами навесили на машинку все модули, что были в комплекте, и вы можете запрограммировать робота как минимум на:
-	Управление через ИК & Bluetooth
-	Автономное движение по нарисованной линии
-	Автономное движение с избеганием препятствий
Можно расширить круг обязанностей робота, если вы докупите к нему модули (или платформы). Модули это, по сути, разнообразные датчики и устройства, которые сделаны в удобном для ардуино форм-факторе, который исключает необходимость пайки, например. Есть модули, основанные на датчиках температуры, давления, ИК диодах и пр. Есть двигатели, драйвера к ним, солнечные батареи и много всего прочего. Достаточно дешево их можно купить в Китае.
Инструкции к роботу можно найти в google и youtube по запросам «робот ардуино», и значительно больше инструкций вы найдете на английском языке (aruino robot).

**Немного о подключении проводов**

После сборки робота необходимо соединить модули между собой. Для этого нужно соединить пины на драйвере шагового двигателя (красная микросхема) с пинами на ардуино или плате расширения.
Пин это вид электрического соединителя, он может быть в виде розетки или гнезда. В обиходе пинами называют, по сути, любой вид вывода от контакта микросхемы.
А вот соединять их нужно ТОЛЬКО исходя из особенностей скетча или можно самим менять в скетче значения подключаемых пинов. Ну или писать скетч самим.
Скетч - это программа, написанная в среде Arduino IDE.
Сборку и подключение машинки поясню на примере скетча для управления через ИК & BT.


Распиновка (цоколевка) ардуино выглядит вот так:

![Image alt](https://raw.githubusercontent.com/dsidov/ArduinoCar/master/img/arduino_pinout.jpg)
Мы будем использовать следующие пины: 
-	Цифровые (Digital Pins) - в коде они определяются через цифры (0-13)
-	Входное питание (Vin)
-	Питание (5V, V)
-	Заземление (GND, G)

Если поставить сверху шилд, то распиновка не изменится, но добавятся дублирующие цифровые и аналоговые выходы и появится много пинов земля+питание.

Обратите внимание, что на каждый радиотехнический компонент, будь то диод или модуль, есть т.н. даташит (datasheet) – инструкция, которая описывает характеристики, особенности подключения, функционал и прочую необходимую об устройстве информацию. Как ее искать я объяснял на лекции, но если простым языком, то все опять же ищется в google исходя из той маркировки, что нанесена на модули. Если с маркировками все плохо, то можно использовать google картинки =)

Шилд выглядит примерно вот так:
![Image alt](https://raw.githubusercontent.com/dsidov/ArduinoCar/master/img/sensor_shield.jpg)

Вот так выглядит ИК датчик:
![Image alt](https://raw.githubusercontent.com/dsidov/ArduinoCar/master/img/ir_module.jpg?style=centerme)

А вот так Bluetooth датчик:
![Image alt](https://raw.githubusercontent.com/dsidov/ArduinoCar/master/img/bt_module.jpg)

**Подключение модулей к ардуино**

Как я писал ранее, при соединении модулей надо исходить из особенностей скетча. Если какой-то модуль, двигатель и т.д. не предусматривает его подключение, НЕ НАДО ЕГО ПОДКЛЮЧАТЬ. Лучше пусть провода болтаются.
Например, возьмем, скетч для управления через ИК & Bluetooth “IR_BT_Remote_Control_Car_v2_1” (про прошивку скетчей есть отдельная тема ниже). Нам нужно подключить драйвер шагового двигателя, ИК и Bluetooth датчики.
![Image alt](https://raw.githubusercontent.com/dsidov/ArduinoCar/master/img/ide_code.jpg)

В нем, если приглядеться, можно увидеть, что за сигнал с ИК порта отвечает 10 цифровой пин, за двигатели пины 3-7, 9. 

Поэтому ИК датчик подключаем так:
G -- GND
R -- 5V
Y -- 10
Важно! Не перепутайте контакты, ИК датчики ОТЛИЧНО ГОРЯТ, если их неправильно подключить.

А драйвер подключаем вот так: 
ENB -- 3
IN4 -- 4
IN3 -- 5
IN2 -- 6
IN1 -- 7
ENA -- 9

*ENA, IN1, IN2 - пины управления правой парой двигателей*
*ENB, IN3, IN4 - левой парой двигателей*
И не забываем присоединить Vin -- Vms (отвечает за внешнее питание).

У некоторых были перепутаны красные и черные провода на машинке, что, может привести к тому, что колеса будут крутиться в разные стороны. Если это произошло, попробуйте попарно поменять пины IN<> на одной из пар двигателей.
«Реакция» на ИК пульт тоже программируется. Например, при нажатии кнопки CH выдается значение 0х00FF629D. Поэтому на действие можно присвоить любую кнопку любого пульта, если вы знаете ее значение. 
Для нашего пульта (HX1838) значения следующие:
PWR       FFE21D 
CH        FF629D      
|<<       FF22DD  
>|        FFC23D              
>>|       FF02FD               
-         FFE01F 
Plus      FFA857         
EQ        FF906F          
0         FF6897            
100       FF9867           
200       FFB04F           
1         FF30CF                 
2         FF18E7                 
3         FF7A85                  
4         FF10EF                   
5         FF38C7                    
6         FF5AA5                  
7         FF42BD                  
8         FF48B5             
9         FF52AD 

Можете попробовать поменять их затем в коде и посмотреть что из этого выйдет.
 
Bluetooth датчик подключается через протокол UART, он задействует цифровые пины 0 и 1.
VCC -- 5V
GND -- GND
RXD -- TX (1)
TXD -- RX (0)

Важно! При прошивке Ардуино RX и TX должны быть отключены, или у вас постоянно будет выскакивать ошибка загрузки.

**Если вам не хватает коннекторов**
Для этого существуют провода F-F (мама-мама) с двумя розетками. В комплекте их нет, но вы можете воспользоваться макетной платой:
![Image alt](https://raw.githubusercontent.com/dsidov/ArduinoCar/master/img/breadboard.jpg)

### 2. Прошивка Arduino
Фактически, ваша машина имеет неограниченное число функций, если вы знаете как ее программировать. Если нет, можно взять стандартный и загрузить его в микроконтроллер. Для этого нужно:
##### 2.1 Скачать и установить среду программирования Arduino IDE
https://www.arduino.cc/en/Main/Donate (Донатить необязательно, можно “Just download”)
При этом нужно одобрить установку всех необходимых драйверов.
##### 2.2 Скачать скетчи и библиотеки
https://www.dropbox.com/sh/by3x7xyw1mdopqt/AAAgEufkdTPKkAHdKMXGBifWa?dl=0
##### 2.3 Распаковать библиотеки для Arduino IDE
Иногда вам придется пользоваться библиотеками. Библиотеки используются, в основном, для того, чтобы перевести машинные функции обращения с модулем на более-менее человеческий язык. 
Подключение библиотеки в скетче происходит с помощью ф-ии #include, также можно посмотреть, какие библиотеки используются. Так, в скетче управления машинкой используется библиотека для ИК порта (#include <IRremote.h>). Для того, чтобы среда ардуино не ругалась на ее отсутствие, надо распаковать IRremote.zip в папку 
This PC \ Documents \ Arduino \ libraries
или 
С:\Users\#Name\Documents\Arduino\libraries
 
##### 2.4 Прошивка микроконтроллера
Запускаем среду Arduino IDE и скетч. Для этого достаточно кликнуть на желаемом скетче расширения .ino
Подключаем плату Ардуино к ПК. Ардуино должно определиться в программе:

![Image alt](https://raw.githubusercontent.com/dsidov/ArduinoCar/master/img/ide_port.jpg)
В разделе “Плата” должна стоять “Arduino UNO”

После этого мы жмем кнопку “загрузить” 

![Image alt](https://raw.githubusercontent.com/dsidov/ArduinoCar/master/img/ide_upload.jpg)
И ждем пока пока программа загрузится в Ардуино.

В случае удачной прошивки все готово, можете пользоваться машинкой.

### 3. Управление
Важный момент - если светодиоды у машинки горят, но она не двигается, то проблема, возможно, в батарейках, они быстро садятся и если тока в них недостаточно (особенно дешевые батарейки), то двигатели просто не работают. 
Поэтому для тестирования лучше использовать блок питания 7-12В, подключив его напрямую к входу ардуино (DC Power Jack) или к коннектору.
 
##### 3.1 ИК Порт. 
Машинка управляется с пульта, для управления используются вот эти кнопки:
(где квадрат это “стоп”)

![Image alt](https://raw.githubusercontent.com/dsidov/ArduinoCar/master/img/ir_controller.jpg)
Если машинка не едет, нужно нажать несколько раз вперед-назад.

##### 3.2 Bluetooth
Управление с помощью Bluetooth осуществляется с помощью программы BLEJoystick (Android & IOS)

![Image alt](https://raw.githubusercontent.com/dsidov/ArduinoCar/master/img/ble-joystick_app.jpg)
Сначала нужно узнать MAC адрес bluetooth модуля. Для этого нужно подать питание на модуль, уйти подальше от других bluetooth устройств и просканировать MAC адреса с помощью программы. 
![Image alt](https://raw.githubusercontent.com/dsidov/ArduinoCar/master/img/ble-joystick_scan.jpg)
Один из адресов должен быть вашим (обычно он начинается на BT-05).
Адрес лучше записать.

Для подключения к машинке нужно нажать на соответствующий ей MAC адрес и нажать CONNECT. 
Если у значка BT справа сверху появились две точки, это значит, что устройства сопряжены и можно продолжать, если нет, нужно попробовать еще раз, включив-выключив машинку.

![Image alt](https://raw.githubusercontent.com/dsidov/ArduinoCar/master/img/ble-joystick_control.jpg)
Управление - слева движение, Х - стоп.

В скетче вы также можете найти настройки Bluetooth и при необходимости использовать любое другое понравившееся приложение:

![Image alt](https://raw.githubusercontent.com/dsidov/ArduinoCar/master/img/ide_code-bt.jpg)

Символы A, C, B, D, G – это установки приложения BLEJoystick, другие приложения могут иметь другие управляющие символы.

### 4. Прочие прошивки
В папках вы также можете найти другие программы для машинки.
Папка Sketches-Factory содержит в себе программы, любезно украденные у китайцев.
Можете запрограммировать машинку на движение по линии или избегание препятствий. 


<!---
<p align="center">
  <img src="https://raw.githubusercontent.com/dsidov/ArduinoCar/master/img/bt_module.jpg">
</p>
--->
